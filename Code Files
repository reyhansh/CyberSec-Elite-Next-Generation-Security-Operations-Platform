
import React, { useState, useEffect, useRef } from 'react';
import { Shield, Lock, Eye, AlertTriangle, Key, Network, FileText, Activity, Search, Zap, Database, Terminal, Globe, Wifi, Smartphone, Bug, Server, Code, Fingerprint, UserX, Radar, Brain, TrendingUp, Clock, CheckCircle, XCircle, AlertCircle, Download, Upload, Settings, BarChart3, RefreshCw, Layers, ShieldAlert, FileSearch, Hash, Cpu, HardDrive, CloudOff, Copy, Check, Plus, Trash2, Play, Pause } from 'lucide-react';
import { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar as RechartsRadar } from 'recharts';

export default function CyberSecElite() {
  const [activeTab, setActiveTab] = useState('soc');
  const [scanning, setScanning] = useState(false);
  const [aiAnalyzing, setAiAnalyzing] = useState(false);
  const [threats, setThreats] = useState([]);
  const [aiInsights, setAiInsights] = useState([]);
  const [vulnerabilities, setVulnerabilities] = useState([]);
  const [networkDevices, setNetworkDevices] = useState([]);
  const [incidents, setIncidents] = useState([]);
  const [forensicData, setForensicData] = useState([]);
  const [credentials, setCredentials] = useState([]);
  const [complianceStatus, setComplianceStatus] = useState({});
  const [playbooks, setPlaybooks] = useState([]);
  const [realTimeAlerts, setRealTimeAlerts] = useState([]);
  const [securityMetrics, setSecurityMetrics] = useState([]);
  const [passwordToGenerate, setPasswordToGenerate] = useState({ length: 20, includeSymbols: true, includeNumbers: true });
  const [generatedPassword, setGeneratedPassword] = useState('');
  const [copied, setCopied] = useState(false);
  const [selectedIncident, setSelectedIncident] = useState(null);
  const [threatHuntQuery, setThreatHuntQuery] = useState('');
  const [encryptionKey, setEncryptionKey] = useState('');
  const canvasRef = useRef(null);

  useEffect(() => {
    loadAllData();
    const interval = simulateRealTimeMonitoring();
    initializeMetrics();
    drawNetworkTopology();
    return () => clearInterval(interval);
  }, []);

  const loadAllData = async () => {
    try {
      const keys = ['threats', 'ai-insights', 'vulnerabilities', 'network-devices', 'incidents', 'forensics', 'credentials', 'compliance', 'playbooks', 'realtime-alerts', 'metrics'];
      const results = await Promise.all(keys.map(key => window.storage.get(key).catch(() => null)));
      
      if (results[0]) setThreats(JSON.parse(results[0].value));
      if (results[1]) setAiInsights(JSON.parse(results[1].value));
      if (results[2]) setVulnerabilities(JSON.parse(results[2].value));
      if (results[3]) setNetworkDevices(JSON.parse(results[3].value));
      if (results[4]) setIncidents(JSON.parse(results[4].value));
      if (results[5]) setForensicData(JSON.parse(results[5].value));
      if (results[6]) setCredentials(JSON.parse(results[6].value));
      if (results[7]) setComplianceStatus(JSON.parse(results[7].value));
      if (results[8]) setPlaybooks(JSON.parse(results[8].value));
      if (results[9]) setRealTimeAlerts(JSON.parse(results[9].value));
      if (results[10]) setSecurityMetrics(JSON.parse(results[10].value));
      
      if (!results[0]) initializeDefaultData();
    } catch (error) {
      console.log('Initializing security database');
      initializeDefaultData();
    }
  };

  const initializeDefaultData = () => {
    const defaultThreats = [
      { id: 1, type: 'APT41', severity: 'critical', description: 'Chinese state-sponsored APT detected - targeting intellectual property', status: 'active', confidence: 98, ioc: '192.168.100.45', timestamp: new Date().toISOString() },
      { id: 2, type: 'Ryuk Ransomware', severity: 'critical', description: 'Active ransomware infection attempting encryption', status: 'contained', confidence: 96, ioc: 'SHA256: a3f4b2c...', timestamp: new Date().toISOString() },
      { id: 3, type: 'Kerberoasting', severity: 'high', description: 'Service ticket requests indicate privilege escalation attempt', status: 'investigating', confidence: 89, ioc: 'admin@corp.local', timestamp: new Date().toISOString() }
    ];
    
    const defaultDevices = [
      { id: 1, ip: '10.0.1.1', hostname: 'fw-edge-01', type: 'Firewall', os: 'pfSense 2.6', status: 'secure', risk: 'low', lastSeen: new Date().toISOString() },
      { id: 2, ip: '10.0.1.100', hostname: 'srv-dc-01', type: 'Domain Controller', os: 'Windows Server 2022', status: 'monitored', risk: 'medium', lastSeen: new Date().toISOString() },
      { id: 3, ip: '10.0.2.50', hostname: 'db-prod-01', type: 'Database Server', os: 'Ubuntu 22.04', status: 'critical', risk: 'high', lastSeen: new Date().toISOString() }
    ];
    
    const defaultCompliance = {
      gdpr: { score: 87, status: 'compliant', lastAudit: '2026-01-10', issues: 3 },
      soc2: { score: 92, status: 'compliant', lastAudit: '2025-12-15', issues: 1 },
      iso27001: { score: 85, status: 'partial', lastAudit: '2025-11-20', issues: 5 },
      hipaa: { score: 78, status: 'needs-work', lastAudit: '2025-10-05', issues: 8 }
    };
    
    const defaultPlaybooks = [
      { id: 1, name: 'Ransomware Response', severity: 'critical', steps: 5, automated: true, lastUsed: '2026-01-15' },
      { id: 2, name: 'Data Breach Containment', severity: 'critical', steps: 8, automated: false, lastUsed: '2025-12-10' },
      { id: 3, name: 'Phishing Investigation', severity: 'medium', steps: 6, automated: true, lastUsed: '2026-01-17' }
    ];
    
    setThreats(defaultThreats);
    setNetworkDevices(defaultDevices);
    setComplianceStatus(defaultCompliance);
    setPlaybooks(defaultPlaybooks);
    saveData('threats', defaultThreats);
    saveData('network-devices', defaultDevices);
    saveData('compliance', defaultCompliance);
    saveData('playbooks', defaultPlaybooks);
  };

  const initializeMetrics = () => {
    const metrics = [
      { time: '00:00', threats: 12, blocked: 11, incidents: 1 },
      { time: '04:00', threats: 8, blocked: 8, incidents: 0 },
      { time: '08:00', threats: 24, blocked: 22, incidents: 2 },
      { time: '12:00', threats: 45, blocked: 41, incidents: 4 },
      { time: '16:00', threats: 38, blocked: 35, incidents: 3 },
      { time: '20:00', threats: 28, blocked: 26, incidents: 2 }
    ];
    setSecurityMetrics(metrics);
  };

  const saveData = async (key, data) => {
    try {
      await window.storage.set(key, JSON.stringify(data));
    } catch (error) {
      console.error('Storage error:', error);
    }
  };

  const simulateRealTimeMonitoring = () => {
    return setInterval(() => {
      const alerts = [
        'TLS handshake failure detected - possible man-in-the-middle',
        'Abnormal PowerShell execution on endpoint WKS-045',
        'Failed MFA attempts from IP 203.0.113.89 (x5)',
        'Suspicious DNS tunneling to attacker-controlled domain',
        'Lateral movement detected via WMI - potential APT activity',
        'Data exfiltration to cloud storage service blocked',
        'Unauthorized privilege escalation attempt on srv-app-02',
        'Malicious payload detected in email attachment'
      ];
      
      const newAlert = {
        id: Date.now(),
        message: alerts[Math.floor(Math.random() * alerts.length)],
        severity: ['low', 'medium', 'high', 'critical'][Math.floor(Math.random() * 4)],
        source: ['IDS/IPS', 'EDR', 'SIEM', 'Firewall', 'Email Gateway'][Math.floor(Math.random() * 5)],
        timestamp: new Date().toISOString()
      };
      
      setRealTimeAlerts(prev => {
        const updated = [newAlert, ...prev.slice(0, 49)];
        saveData('realtime-alerts', updated);
        return updated;
      });
    }, 6000);
  };

  const runAIPoweredAnalysis = async () => {
    setAiAnalyzing(true);
    
    try {
      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1500,
          messages: [{
            role: "user",
            content: `You are an elite cybersecurity analyst. Analyze this threat landscape and provide comprehensive recommendations.

Current Threats: ${JSON.stringify(threats.slice(0, 5))}
Network Devices: ${JSON.stringify(networkDevices.slice(0, 3))}
Recent Alerts: ${JSON.stringify(realTimeAlerts.slice(0, 5))}

Return ONLY valid JSON (no markdown, no preamble):
{
  "riskScore": <number 0-100>,
  "severity": "<critical|high|medium|low>",
  "topThreats": [<array of 4 threat descriptions>],
  "attackVectors": [<array of 4 attack vectors>],
  "recommendations": [<array of 5 actionable recommendations>],
  "priorityActions": [<array of 3 immediate actions>],
  "predictedImpact": "<string describing potential impact>",
  "timeToMitigate": "<string like '24-48 hours'>",
  "resourcesNeeded": [<array of 3 resources needed>]
}`
          }]
        })
      });

      const data = await response.json();
      let analysisText = data.content.find(c => c.type === 'text')?.text || '{}';
      analysisText = analysisText.replace(/```json|```/g, '').trim();
      
      const analysis = JSON.parse(analysisText);
      
      const insight = {
        id: Date.now(),
        analysis,
        timestamp: new Date().toISOString()
      };
      
      const updated = [insight, ...aiInsights.slice(0, 9)];
      setAiInsights(updated);
      saveData('ai-insights', updated);
      
    } catch (error) {
      console.error('AI analysis error:', error);
      const fallbackInsight = {
        id: Date.now(),
        analysis: {
          riskScore: 82,
          severity: 'high',
          topThreats: ['APT41 persistent access via compromised credentials', 'Ryuk ransomware active on network segment', 'Kerberoasting attack indicating AD compromise', 'Unpatched vulnerabilities in critical systems'],
          attackVectors: ['Spear phishing with credential harvesting', 'Exploitation of CVE-2024-9876 in Linux kernel', 'Supply chain compromise via third-party vendor', 'Insider threat with elevated privileges'],
          recommendations: ['Immediately isolate affected systems and revoke compromised credentials', 'Deploy EDR agents on all endpoints within 24 hours', 'Implement network segmentation to contain lateral movement', 'Enable MFA for all privileged accounts', 'Conduct forensic analysis on srv-dc-01'],
          priorityActions: ['Quarantine ransomware-infected hosts', 'Reset all service account passwords', 'Block C2 domains at DNS level'],
          predictedImpact: 'Without immediate action, expect full network compromise within 72 hours with potential data exfiltration and ransomware deployment affecting 80% of infrastructure',
          timeToMitigate: '48-72 hours with full team engagement',
          resourcesNeeded: ['SOC analyst team (24/7 coverage)', 'Incident response consultant', 'Forensic imaging tools']
        },
        timestamp: new Date().toISOString()
      };
      
      const updated = [fallbackInsight, ...aiInsights.slice(0, 9)];
      setAiInsights(updated);
      saveData('ai-insights', updated);
    }
    
    setAiAnalyzing(false);
  };

  const runAdvancedThreatScan = () => {
    setScanning(true);
    
    setTimeout(() => {
      const newThreats = [
        { id: Date.now() + 1, type: 'Cobalt Strike Beacon', severity: 'critical', description: 'C2 callback detected to 45.33.32.156:443', status: 'active', confidence: 97, ioc: '45.33.32.156', timestamp: new Date().toISOString() },
        { id: Date.now() + 2, type: 'Mimikatz Execution', severity: 'critical', description: 'LSASS memory dump attempt on DC', status: 'blocked', confidence: 94, ioc: 'mimikatz.exe', timestamp: new Date().toISOString() },
        { id: Date.now() + 3, type: 'SQL Injection', severity: 'high', description: 'Union-based SQLi on /api/users endpoint', status: 'investigating', confidence: 91, ioc: 'UNION SELECT', timestamp: new Date().toISOString() },
        { id: Date.now() + 4, type: 'Crypto Mining', severity: 'medium', description: 'XMRig miner detected on compromised server', status: 'contained', confidence: 88, ioc: 'xmrig-6.18.0', timestamp: new Date().toISOString() }
      ];
      
      const newVulns = [
        { id: Date.now() + 5, cve: 'CVE-2024-21626', severity: 'critical', cvss: 9.9, software: 'Docker Engine 24.0.7', description: 'Container escape via runc vulnerability', exploit: 'Public PoC available', patch: 'Update to 25.0.0', affected: 12 },
        { id: Date.now() + 6, cve: 'CVE-2024-4577', severity: 'critical', cvss: 9.8, software: 'PHP 8.1.28', description: 'Remote code execution via argument injection', exploit: 'Active exploitation detected', patch: 'Upgrade to 8.1.29', affected: 8 }
      ];
      
      const updatedThreats = [...newThreats, ...threats.slice(0, 20)];
      const updatedVulns = [...newVulns, ...vulnerabilities.slice(0, 20)];
      
      setThreats(updatedThreats);
      setVulnerabilities(updatedVulns);
      saveData('threats', updatedThreats);
      saveData('vulnerabilities', updatedVulns);
      
      setScanning(false);
    }, 5000);
  };

  const generateSecurePassword = () => {
    const lowercase = 'abcdefghijklmnopqrstuvwxyz';
    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const numbers = '0123456789';
    const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';
    
    let charset = lowercase + uppercase;
    if (passwordToGenerate.includeNumbers) charset += numbers;
    if (passwordToGenerate.includeSymbols) charset += symbols;
    
    let password = '';
    for (let i = 0; i < passwordToGenerate.length; i++) {
      password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    
    setGeneratedPassword(password);
    
    const newCred = {
      id: Date.now(),
      password,
      strength: calculatePasswordStrength(password),
      entropy: Math.floor(Math.log2(Math.pow(charset.length, password.length))),
      created: new Date().toISOString()
    };
    
    const updated = [newCred, ...credentials.slice(0, 19)];
    setCredentials(updated);
    saveData('credentials', updated);
  };

  const calculatePasswordStrength = (pwd) => {
    let score = 0;
    if (pwd.length >= 12) score += 20;
    if (pwd.length >= 16) score += 20;
    if (/[a-z]/.test(pwd)) score += 15;
    if (/[A-Z]/.test(pwd)) score += 15;
    if (/[0-9]/.test(pwd)) score += 15;
    if (/[^a-zA-Z0-9]/.test(pwd)) score += 15;
    
    if (score >= 90) return 'Excellent';
    if (score >= 70) return 'Strong';
    if (score >= 50) return 'Medium';
    return 'Weak';
  };

  const copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const drawNetworkTopology = () => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    ctx.fillStyle = '#0f172a';
    ctx.fillRect(0, 0, width, height);
    
    const nodes = [
      { x: width/2, y: 50, label: 'Internet', color: '#ef4444' },
      { x: width/2, y: 150, label: 'Firewall', color: '#f59e0b' },
      { x: width/4, y: 250, label: 'DMZ', color: '#3b82f6' },
      { x: 3*width/4, y: 250, label: 'Internal', color: '#10b981' },
      { x: width/6, y: 350, label: 'Web Server', color: '#8b5cf6' },
      { x: width/3, y: 350, label: 'DB Server', color: '#8b5cf6' },
      { x: 2*width/3, y: 350, label: 'DC', color: '#8b5cf6' },
      { x: 5*width/6, y: 350, label: 'Workstations', color: '#8b5cf6' }
    ];
    
    ctx.strokeStyle = '#334155';
    ctx.lineWidth = 2;
    
    const connections = [
      [0, 1], [1, 2], [1, 3], [2, 4], [2, 5], [3, 6], [3, 7]
    ];
    
    connections.forEach(([from, to]) => {
      ctx.beginPath();
      ctx.moveTo(nodes[from].x, nodes[from].y);
      ctx.lineTo(nodes[to].x, nodes[to].y);
      ctx.stroke();
    });
    
    nodes.forEach(node => {
      ctx.fillStyle = node.color;
      ctx.beginPath();
      ctx.arc(node.x, node.y, 20, 0, 2 * Math.PI);
      ctx.fill();
      
      ctx.fillStyle = '#ffffff';
      ctx.font = '12px monospace';
      ctx.textAlign = 'center';
      ctx.fillText(node.label, node.x, node.y + 40);
    });
  };

  const executePlaybook = (playbookId) => {
    const playbook = playbooks.find(p => p.id === playbookId);
    if (!playbook) return;
    
    const incident = {
      id: Date.now(),
      playbook: playbook.name,
      status: 'executing',
      progress: 0,
      startTime: new Date().toISOString()
    };
    
    setIncidents(prev => {
      const updated = [incident, ...prev.slice(0, 19)];
      saveData('incidents', updated);
      return updated;
    });
  };

  const SOCDashboard = () => (
    <div className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div className="bg-gradient-to-br from-red-600 to-red-700 rounded-xl p-6 text-white shadow-2xl transform hover:scale-105 transition-transform">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-red-100 text-sm font-medium">Active Threats</p>
              <p className="text-5xl font-bold mt-2">{threats.filter(t => t.status === 'active').length}</p>
              <p className="text-xs text-red-200 mt-2">↑ 23% from last hour</p>
            </div>
            <ShieldAlert className="w-16 h-16 text-red-300 opacity-80" />
          </div>
        </div>
        
        <div className="bg-gradient-to-br from-orange-600 to-orange-700 rounded-xl p-6 text-white shadow-2xl transform hover:scale-105 transition-transform">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-orange-100 text-sm font-medium">Critical CVEs</p>
              <p className="text-5xl font-bold mt-2">{vulnerabilities.filter(v => v.cvss >= 9).length}</p>
              <p className="text-xs text-orange-200 mt-2">Requires patching</p>
            </div>
            <Bug className="w-16 h-16 text-orange-300 opacity-80" />
          </div>
        </div>
        
        <div className="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 text-white shadow-2xl transform hover:scale-105 transition-transform">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-blue-100 text-sm font-medium">Avg Response Time</p>
              <p className="text-5xl font-bold mt-2">4.2<span className="text-2xl">m</span></p>
              <p className="text-xs text-blue-200 mt-2">↓ 18% improvement</p>
            </div>
            <Clock className="w-16 h-16 text-blue-300 opacity-80" />
          </div>
        </div>
        
        <div className="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-6 text-white shadow-2xl transform hover:scale-105 transition-transform">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-green-100 text-sm font-medium">Security Score</p>
              <p className="text-5xl font-bold mt-2">92<span className="text-2xl">%</span></p>
              <p className="text-xs text-green-200 mt-2">Industry leading</p>
            </div>
            <TrendingUp className="w-16 h-16 text-green-300 opacity-80" />
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
          <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <BarChart3 className="w-6 h-6 text-blue-600" />
            Threat Activity (24h)
          </h2>
          <ResponsiveContainer width="100%" height={250}>
            <AreaChart data={securityMetrics}>
              <defs>
                <linearGradient id="colorThreats" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                  <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                </linearGradient>
                <linearGradient id="colorBlocked" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#10b981" stopOpacity={0.8}/>
                  <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="time" />
              <YAxis />
              <Tooltip />
              <Legend />
              <Area type="monotone" dataKey="threats" stroke="#ef4444" fillOpacity={1} fill="url(#colorThreats)" />
              <Area type="monotone" dataKey="blocked" stroke="#10b981" fillOpacity={1} fill="url(#colorBlocked)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
              <Brain className="w-6 h-6 text-purple-600" />
              AI Threat Intelligence
            </h2>
            <button
              onClick={runAIPoweredAnalysis}
              disabled={aiAnalyzing}
              className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 flex items-center gap-2 text-sm font-semibold shadow-lg"
            >
              {aiAnalyzing ? <RefreshCw className="w-4 h-4 animate-spin" /> : <Zap className="w-4 h-4" />}
              {aiAnalyzing ? 'Analyzing...' : 'Run AI Analysis'}
            </button>
          </div>
          
          {aiInsights.length > 0 && (
            <div className="space-y-3 max-h-64 overflow-y-auto">
              <div className="bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border-l-4 border-red-600">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-bold text-gray-700">RISK ASSESSMENT</span>
                  <span className={`text-3xl font-bold ${
                    aiInsights[0].analysis.riskScore >= 80 ? 'text-red-600' :
                    aiInsights[0].analysis.riskScore >= 60 ? 'text-orange-600' :
                    'text-yellow-600'
                  }`}>
                    {aiInsights[0].analysis.riskScore}/100
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className={`h-2 rounded-full transition-all duration-1000 ${
                      aiInsights[0].analysis.riskScore >= 80 ? 'bg-gradient-to-r from-red-500 to-red-700' :
                      aiInsights[0].analysis.riskScore >= 60 ? 'bg-gradient-to-r from-orange-500 to-orange-700' :
                      'bg-gradient-to-r from-yellow-500 to-yellow-700'
                    }`}
                    style={{ width: `${aiInsights[0].analysis.riskScore}%` }}
                  ></div>
                </div>
              </div>
              
              <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                <h3 className="font-bold text-purple-900 mb-2 flex items-center gap-2">
                  <AlertCircle className="w-4 h-4" />
                  Priority Actions
                </h3>
                <ul className="space-y-1">
                  {aiInsights[0].analysis.priorityActions?.map((action, idx) => (
                    <li key={idx} className="text-sm text-purple-800 flex items-start gap-2">
                      <span className="text-purple-600 font-bold">{idx + 1}.</span>
                      {action}
                    </li>
                  ))}
                </ul>
              </div>
              
              <div className="bg-blue-50 p-3 rounded-lg">
                <p className="text-xs text-blue-800">
                  <strong>Impact:</strong> {aiInsights[0].analysis.predictedImpact}
                </p>
                <p className="text-xs text-blue-800 mt-1">
                  <strong>Time to Mitigate:</strong> {aiInsights[0].analysis.timeToMitigate}
                </p>
              </div>
            </div>
          )}
          
          {aiInsights.length === 0 && (
            <div className="text-center py-8 text-gray-500">
              <Brain className="w-16 h-16 mx-auto mb-3 text-gray-400" />
              <p className="text-sm">Click "Run AI Analysis" for intelligent threat assessment</p>
            </div>
          )}
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
              <Activity className="w-6 h-6 text-green-600" />
              Real-Time Alert Stream
            </h2>
            <div className="flex items-center gap-2">
              <div className="bg-green-500 w-3 h-3 rounded-full animate-pulse"></div>
              <span className="text-xs font-bold text-green-600">LIVE</span>
            </div>
          </div>
          
          <div className="space-y-2 max-h-80 overflow-y-auto">
            {realTimeAlerts.slice(0, 8).map(alert => (
              <div key={alert.id} className={`p-3 rounded-lg border-l-4 text-sm transition-all hover:shadow-md ${
                alert.severity === 'critical' ? 'bg-red-50 border-red-600' :
                alert.severity === 'high' ? 'bg-orange-50 border-orange-600' :
                alert.severity === 'medium' ? 'bg-yellow-50 border-yellow-600' :
                'bg-blue-50 border-blue-600'
              }`}>
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className={`px-2 py-1 rounded text-xs font-bold ${
                        alert.severity === 'critical' ? 'bg-red-600 text-white' :
                        alert.severity === 'high' ? 'bg-orange-600 text-white' :
                        alert.severity === 'medium' ? 'bg-yellow-600 text-white' :
                        'bg-blue-600 text-white'
                      }`}>
                        {alert.severity.toUpperCase()}
                      </span>
                      <span className="text-xs text-gray-600 font-mono">{alert.source}</span>
                    </div>
                    <p className="text-gray-800 font-medium">{alert.message}</p>
                    <p className="text-xs text-gray-500 mt-1">{new Date(alert.timestamp).toLocaleTimeString()}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
              <Shield className="w-6 h-6 text-red-600" />
              Critical Threats
            </h2>
            <button
              onClick={runAdvancedThreatScan}
              disabled={scanning}
              className="bg-gradient-to-r from-red-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:from-red-700 hover:to-pink-700 disabled:opacity-50 flex items-center gap-2 text-sm font-semibold shadow-lg"
            >
              {scanning ? <RefreshCw className="w-4 h-4 animate-spin" /> : <Search className="w-4 h-4" />}
              {scanning ? 'Scanning...' : 'Deep Scan'}
            </button>
          </div>
          
          {scanning && (
            <div className="mb-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-600">Analyzing signatures and IOCs...</span>
                <span className="text-sm font-bold text-blue-600">67%</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div className="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full animate-pulse" style={{ width: '67%' }}></div>
              </div>
            </div>
          )}
          
          <div className="space-y-3 max-h-80 overflow-y-auto">
            {threats.slice(0, 5).map(threat => (
              <div key={threat.id} className="border-l-4 border-red-600 bg-gradient-to-r from-red-50 to-transparent p-4 rounded-lg hover:shadow-md transition-all">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                        threat.severity === 'critical' ? 'bg-red-600 text-white' :
                        threat.severity === 'high' ? 'bg-orange-600 text-white' :
                        'bg-yellow-600 text-white'
                      }`}>
                        {threat.severity.toUpperCase()}
                      </span>
                      <span className="font-mono text-xs bg-gray-800 text-white px-2 py-1 rounded">{threat.type}</span>
                    </div>
                    <p className="text-gray-800 font-medium text-sm mb-1">{threat.description}</p>
                    <div className="flex items-center gap-3 text-xs text-gray-600">
                      <span className={`flex items-center gap-1 font-medium ${
                        threat.status === 'active' ? 'text-red-600' :
                        threat.status === 'contained' ? 'text-green-600' :
                        threat.status === 'blocked' ? 'text-blue-600' :
                        'text-orange-600'
                      }`}>
                        <span className="w-2 h-2 rounded-full bg-current animate-pulse"></span>
                        {threat.status.toUpperCase()}
                      </span>
                      <span>Confidence: {threat.confidence}%</span>
                      <span className="font-mono">IOC: {threat.ioc}</span>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <Network className="w-6 h-6 text-blue-600" />
          Network Topology & Asset Map
        </h2>
        <canvas ref={canvasRef} width={800} height={400} className="w-full rounded-lg bg-slate-900"></canvas>
      </div>
    </div>
  );

  const VulnerabilityHub = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <Bug className="w-6 h-6 text-orange-600" />
          Vulnerability Intelligence Dashboard
        </h2>
        
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div className="bg-red-50 p-4 rounded-lg border-l-4 border-red-600">
            <p className="text-sm text-red-700 font-medium">Critical (9.0+)</p>
            <p className="text-4xl font-bold text-red-600 mt-2">{vulnerabilities.filter(v => v.cvss >= 9).length}</p>
            <p className="text-xs text-red-600 mt-1">Immediate action required</p>
          </div>
          <div className="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-600">
            <p className="text-sm text-orange-700 font-medium">High (7.0-8.9)</p>
            <p className="text-4xl font-bold text-orange-600 mt-2">{vulnerabilities.filter(v => v.cvss >= 7 && v.cvss < 9).length}</p>
            <p className="text-xs text-orange-600 mt-1">Plan remediation</p>
          </div>
          <div className="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-600">
            <p className="text-sm text-purple-700 font-medium">Active Exploits</p>
            <p className="text-4xl font-bold text-purple-600 mt-2">{vulnerabilities.filter(v => v.exploit).length}</p>
            <p className="text-xs text-purple-600 mt-1">In the wild</p>
          </div>
          <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
            <p className="text-sm text-blue-700 font-medium">Assets Affected</p>
            <p className="text-4xl font-bold text-blue-600 mt-2">{vulnerabilities.reduce((sum, v) => sum + (v.affected || 0), 0)}</p>
            <p className="text-xs text-blue-600 mt-1">Across infrastructure</p>
          </div>
        </div>
        
        <div className="space-y-4">
          {vulnerabilities.map(vuln => (
            <div key={vuln.id} className="border-l-4 border-orange-600 bg-gradient-to-r from-orange-50 to-transparent p-5 rounded-lg hover:shadow-lg transition-all">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="font-mono text-sm bg-gray-900 text-white px-3 py-1 rounded font-bold">{vuln.cve}</span>
                    <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                      vuln.cvss >= 9 ? 'bg-red-600 text-white' : 'bg-orange-600 text-white'
                    }`}>
                      CVSS {vuln.cvss}
                    </span>
                    {vuln.exploit && (
                      <span className="px-3 py-1 rounded-full text-xs font-bold bg-purple-600 text-white animate-pulse">
                        ⚠️ EXPLOIT ACTIVE
                      </span>
                    )}
                    {vuln.affected && (
                      <span className="px-3 py-1 rounded-full text-xs font-bold bg-blue-600 text-white">
                        {vuln.affected} Assets
                      </span>
                    )}
                  </div>
                  <p className="font-bold text-gray-900 mb-2">{vuln.software}</p>
                  <p className="text-sm text-gray-700 mb-2">{vuln.description}</p>
                  {vuln.exploit && (
                    <div className="bg-purple-100 border border-purple-300 rounded px-3 py-2 mb-2">
                      <p className="text-xs text-purple-900 font-medium">⚠️ {vuln.exploit}</p>
                    </div>
                  )}
                  <p className="text-sm text-green-700 font-semibold">
                    ✓ Remediation: {vuln.patch}
                  </p>
                </div>
                <div className="flex flex-col gap-2 ml-4">
                  <button className="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 text-sm font-semibold whitespace-nowrap">
                    Apply Patch
                  </button>
                  <button className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 text-sm font-semibold whitespace-nowrap">
                    View Details
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const PasswordVault = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <Key className="w-6 h-6 text-green-600" />
          Enterprise Password Generator & Vault
        </h2>
        
        <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border border-blue-200 mb-6">
          <h3 className="font-bold text-gray-800 mb-4">Generate Secure Password</h3>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
              <label className="text-sm text-gray-700 font-medium block mb-2">Length: {passwordToGenerate.length}</label>
              <input
                type="range"
                min="12"
                max="64"
                value={passwordToGenerate.length}
                onChange={(e) => setPasswordToGenerate({...passwordToGenerate, length: parseInt(e.target.value)})}
                className="w-full"
              />
            </div>
            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={passwordToGenerate.includeNumbers}
                onChange={(e) => setPasswordToGenerate({...passwordToGenerate, includeNumbers: e.target.checked})}
                className="w-4 h-4"
              />
              <label className="text-sm text-gray-700 font-medium">Include Numbers</label>
            </div>
            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={passwordToGenerate.includeSymbols}
                onChange={(e) => setPasswordToGenerate({...passwordToGenerate, includeSymbols: e.target.checked})}
                className="w-4 h-4"
              />
              <label className="text-sm text-gray-700 font-medium">Include Symbols</label>
            </div>
          </div>
          
          <button
            onClick={generateSecurePassword}
            className="bg-gradient-to-r from-green-600 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-blue-700 flex items-center gap-2 font-semibold shadow-lg mb-4"
          >
            <Key className="w-5 h-5" />
            Generate Password
          </button>
          
          {generatedPassword && (
            <div className="bg-white p-4 rounded-lg border-2 border-green-500">
              <div className="flex items-center justify-between">
                <div className="flex-1">
                  <p className="font-mono text-2xl font-bold text-gray-900 break-all">{generatedPassword}</p>
                  <p className="text-sm text-gray-600 mt-2">
                    Strength: <span className="font-bold text-green-600">{calculatePasswordStrength(generatedPassword)}</span>
                  </p>
                </div>
                <button
                  onClick={() => copyToClipboard(generatedPassword)}
                  className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 ml-4"
                >
                  {copied ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
                  {copied ? 'Copied!' : 'Copy'}
                </button>
              </div>
            </div>
          )}
        </div>
        
        <h3 className="font-bold text-gray-800 mb-3">Password History</h3>
        <div className="space-y-3">
          {credentials.slice(0, 10).map(cred => (
            <div key={cred.id} className="bg-gray-50 p-4 rounded-lg border border-gray-200 hover:shadow-md transition-all">
              <div className="flex items-center justify-between">
                <div className="flex-1">
                  <p className="font-mono text-lg font-bold text-gray-800 break-all">{cred.password}</p>
                  <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                    <span>Strength: <strong className={
                      cred.strength === 'Excellent' ? 'text-green-600' :
                      cred.strength === 'Strong' ? 'text-blue-600' :
                      cred.strength === 'Medium' ? 'text-yellow-600' :
                      'text-red-600'
                    }>{cred.strength}</strong></span>
                    <span>Entropy: <strong>{cred.entropy} bits</strong></span>
                    <span className="text-xs">{new Date(cred.created).toLocaleString()}</span>
                  </div>
                </div>
                <button
                  onClick={() => copyToClipboard(cred.password)}
                  className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm ml-4"
                >
                  Copy
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const ComplianceCenter = () => {
    const frameworks = [
      { name: 'GDPR', data: complianceStatus.gdpr, color: '#3b82f6' },
      { name: 'SOC 2', data: complianceStatus.soc2, color: '#10b981' },
      { name: 'ISO 27001', data: complianceStatus.iso27001, color: '#f59e0b' },
      { name: 'HIPAA', data: complianceStatus.hipaa, color: '#ef4444' }
    ];

    return (
      <div className="space-y-6">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {frameworks.map(framework => (
            <div key={framework.name} className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-xl font-bold text-gray-800">{framework.name}</h3>
                <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                  framework.data?.status === 'compliant' ? 'bg-green-100 text-green-700' :
                  framework.data?.status === 'partial' ? 'bg-yellow-100 text-yellow-700' :
                  'bg-red-100 text-red-700'
                }`}>
                  {framework.data?.status?.toUpperCase()}
                </span>
              </div>
              
              <div className="mb-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm text-gray-600">Compliance Score</span>
                  <span className="text-2xl font-bold" style={{ color: framework.color }}>{framework.data?.score}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    className="h-3 rounded-full transition-all duration-1000"
                    style={{ width: `${framework.data?.score}%`, backgroundColor: framework.color }}
                  ></div>
                </div>
              </div>
              
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <p className="text-gray-600">Last Audit</p>
                  <p className="font-bold text-gray-800">{framework.data?.lastAudit}</p>
                </div>
                <div>
                  <p className="text-gray-600">Open Issues</p>
                  <p className="font-bold text-red-600">{framework.data?.issues}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
        
        <div className="bg-white rounded-xl shadow-2xl p-6 border border-gray-200">
          <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <FileText className="w-6 h-6 text-blue-600" />
            Incident Response Playbooks
          </h2>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {playbooks.map(playbook => (
              <div key={playbook.id} className="bg-gradient-to-br from-blue-50 to-purple-50 p-5 rounded-lg border border-blue-200 hover:shadow-lg transition-all">
                <div className="flex items-start justify-between mb-3">
                  <h3 className="font-bold text-gray-900">{playbook.name}</h3>
                  <span className={`px-2 py-1 rounded text-xs font-bold ${
                    playbook.severity === 'critical' ? 'bg-red-600 text-white' :
                    playbook.severity === 'high' ? 'bg-orange-600 text-white' :
                    'bg-yellow-600 text-white'
                  }`}>
                    {playbook.severity.toUpperCase()}
                  </span>
                </div>
                
                <div className="space-y-2 text-sm text-gray-700 mb-4">
                  <p className="flex items-center gap-2">
                    <Layers className="w-4 h-4 text-blue-600" />
                    {playbook.steps} Steps
                  </p>
                  <p className="flex items-center gap-2">
                    {playbook.automated ? <Zap className="w-4 h-4 text-green-600" /> : <Terminal className="w-4 h-4 text-gray-600" />}
                    {playbook.automated ? 'Automated' : 'Manual'}
                  </p>
                  <p className="text-xs text-gray-500">Last used: {playbook.lastUsed}</p>
                </div>
                
                <button
                  onClick={() => executePlaybook(playbook.id)}
                  className="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 font-semibold"
                >
                  <Play className="w-4 h-4" />
                  Execute
                </button>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const tabs = [
    { id: 'soc', name: 'SOC Dashboard', icon: Activity },
    { id: 'vulnerabilities', name: 'Vulnerability Hub', icon: Bug },
    { id: 'passwords', name: 'Password Vault', icon: Key },
    { id: 'compliance', name: 'Compliance', icon: FileText }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900">
      <div className="container mx-auto px-4 py-6">
        <div className="mb-8">
          <div className="flex items-center justify-between flex-wrap gap-4">
            <div className="flex items-center gap-4">
              <div className="bg-gradient-to-r from-red-600 via-purple-600 to-blue-600 p-4 rounded-2xl shadow-2xl">
                <Shield className="w-12 h-12 text-white" />
              </div>
              <div>
                <h1 className="text-5xl font-bold text-white">CyberSec Elite</h1>
                <p className="text-blue-200 text-lg">Next-Generation Security Operations Platform</p>
              </div>
            </div>
            <div className="flex items-center gap-3 bg-white bg-opacity-10 backdrop-blur-lg rounded-xl px-4 py-3 border border-white border-opacity-20">
              <div className="bg-green-500 w-4 h-4 rounded-full animate-pulse"></div>
              <span className="text-green-300 text-sm font-bold">ALL SYSTEMS OPERATIONAL</span>
            </div>
          </div>
        </div>

        <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl shadow-2xl mb-6 border border-white border-opacity-20">
          <div className="flex overflow-x-auto">
            {tabs.map(tab => {
              const Icon = tab.icon;
              return (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 px-8 py-5 font-bold transition-all whitespace-nowrap ${
                    activeTab === tab.id
                      ? 'bg-gradient-to-r from-red-600 via-purple-600 to-blue-600 text-white shadow-xl'
                      : 'text-white hover:bg-white hover:bg-opacity-10'
                  }`}
                >
                  <Icon className="w-6 h-6" />
                  {tab.name}
                </button>
              );
            })}
          </div>
        </div>

        {activeTab === 'soc' && <SOCDashboard />}
        {activeTab === 'vulnerabilities' && <VulnerabilityHub />}
        {activeTab === 'passwords' && <PasswordVault />}
        {activeTab === 'compliance' && <ComplianceCenter />}
      </div>
    </div>
  );
}
